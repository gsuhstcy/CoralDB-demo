{% extends "genome/base.html" %}
{% load static %}

{% block title %}{{ sp.scientific_name }}{% endblock %}

{% block content %}
<div class="cdb-container">

  <a href="{% url 'home' %}">← Back to Home</a>

  <!-- ===== Header / Cover ===== -->
  <div class="cdb-header">

    {% if sp.static_image %}
      <img class="cdb-cover" src="{% static sp.static_image %}" alt="{{ sp.scientific_name }}">
    {% elif sp.cover_image and sp.cover_image.name %}
      <img class="cdb-cover" src="{{ sp.cover_image.url }}" alt="{{ sp.scientific_name }}">
    {% else %}
      <img class="cdb-cover" src="{% static 'species/placeholder.jpg' %}" alt="No image">
    {% endif %}

    <div class="cdb-headinfo">
      <h1 class="cdb-h1">{{ sp.scientific_name }}</h1>
      {% if sp.common_name %}
        <p class="cdb-muted">{{ sp.common_name }}</p>
      {% endif %}

      <div class="cdb-links">
        {% if sp.ncbi_url %}
          <a href="{{ sp.ncbi_url }}" target="_blank" rel="noopener">NCBI</a>
        {% endif %}
        {% if sp.worms_url %}
          <a href="{{ sp.worms_url }}" target="_blank" rel="noopener">WoRMS</a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- ===== Gallery ===== -->
  {% if sp.images.all %}
    <h2 class="cdb-h2">Gallery</h2>
    <div class="cdb-gallery">
      {% for img in sp.images.all|dictsort:"order" %}
        <div class="cdb-gallery-item">
          <img src="{% static img.static_image %}" alt="{{ img.caption }}">
          {% if img.caption %}
            <div class="cdb-muted">{{ img.caption }}</div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- ===== Taxonomy ===== -->
  <h2 class="cdb-h2">Taxonomy</h2>
  <ul>
    <li>Kingdom: {{ sp.kingdom }}</li>
    <li>Phylum: {{ sp.phylum }}</li>
    <li>Class: {{ sp.class_name }}</li>
    <li>Order: {{ sp.order }}</li>
    <li>Family: {{ sp.family }}</li>
    <li>Genus: {{ sp.genus }}</li>
  </ul>

  <!-- ===== Description ===== -->
  <h2 class="cdb-h2">Description</h2>
  {% if sp.short_desc %}
    <div class="cdb-desc">{{ sp.short_desc|linebreaks }}</div>
  {% else %}
    <p class="cdb-muted">No description yet.</p>
  {% endif %}

  <!-- ===== Downloads ===== -->
  <h2 class="cdb-h2">Downloads</h2>
  <div class="cdb-downloads">
    {% for r in sp.resources.all %}
      <div class="cdb-dlrow">
        <div>
          <div class="cdb-title">{{ r.label }}</div>
          <div class="cdb-muted">
            {{ r.get_file_type_display }}{% if r.version %} · v{{ r.version }}{% endif %}
          </div>
        </div>
        <a class="cdb-btn" href="{% url 'download_resource' r.id %}">Download</a>
      </div>
    {% empty %}
      <p class="cdb-muted">No resources uploaded.</p>
    {% endfor %}
  </div>

</div>

<style>
  .cdb-container{max-width:1100px;margin:0 auto;padding:24px;}
  .cdb-h1{margin:0;}
  .cdb-h2{margin-top:26px;}
  .cdb-muted{opacity:0.75;font-size:13px;}
  .cdb-header{display:flex;gap:16px;align-items:flex-start;margin-top:12px;flex-wrap:wrap;}
  .cdb-cover{width:320px;max-width:100%;height:220px;object-fit:cover;border-radius:12px;border:1px solid #e6e6e6;}
  .cdb-headinfo{min-width:260px;}
  .cdb-links{display:flex;gap:10px;margin-top:8px;flex-wrap:wrap;}
  .cdb-links a{padding:6px 10px;border:1px solid #e6e6e6;border-radius:10px;text-decoration:none;color:inherit;}

  .cdb-desc{border:1px solid #e6e6e6;border-radius:12px;padding:12px;}

  .cdb-downloads{display:flex;flex-direction:column;gap:10px;}
  .cdb-dlrow{display:flex;justify-content:space-between;align-items:center;gap:12px;border:1px solid #e6e6e6;border-radius:12px;padding:12px;}
  .cdb-btn{padding:8px 12px;border:1px solid #111;border-radius:10px;text-decoration:none;color:inherit;}

  /* ===== Gallery styles ===== */
  .cdb-gallery{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
    gap:14px;
    margin-top:16px;
  }
  .cdb-gallery-item img{
    width:100%;
    height:160px;
    object-fit:cover;
    border-radius:10px;
    border:1px solid #e6e6e6;
  }
</style>
{% endblock %}
